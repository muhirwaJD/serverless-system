<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaskFlow - Elegant Task Manager</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
        margin: 0;
        padding: 0;
      }

      body {
        background-color: #f5f5f7;
        color: #1d1d1f;
        line-height: 1.6;
      }

      header {
        background: #000;
        color: #fff;
        padding: 20px;
        text-align: center;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .container {
        max-width: 960px;
        margin: 40px auto;
        background: #fff;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 6px;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 10px;
        font-size: 1rem;
      }

      button {
        background-color: #000;
        color: #fff;
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #333;
      }

      .task-list {
        margin-top: 40px;
      }

      .task-card {
        background: #f9f9fa;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .task-card h3 {
        margin-bottom: 8px;
      }

      .task-meta {
        color: #555;
        font-size: 0.9rem;
      }
    </style>
  </head>

  <body>
    <header>TaskFlow - Elegant Task Manager</header>

    <div class="container">
      <h2>Create New Task</h2>
      <form id="taskForm">
        <div class="form-group">
          <label for="title">Title</label>
          <input type="text" id="title" name="title" required />
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" name="description" required></textarea>
        </div>

        <div class="form-group">
          <label for="assignedTo">Assigned To</label>
          <input type="text" id="assignedTo" name="assignedTo" required />
        </div>

        <div class="form-group">
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="pending">Pending</option>
            <option value="in progress">In Progress</option>
            <option value="completed">Completed</option>
          </select>
        </div>

        <button type="submit">Add Task</button>
      </form>

      <div class="task-list" id="taskList">
        <h2>Tasks</h2>
        <!-- Task cards will go here -->
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("taskForm");

        if (!form) {
          console.error("taskForm not found!");
          return;
        }

        console.log("TaskForm loaded.");

        form.addEventListener("submit", async function (e) {
          e.preventDefault();

          const title = document.getElementById("title").value;
          const description = document.getElementById("description").value;
          const assignedTo = document.getElementById("assignedTo").value;
          const status = document.getElementById("status").value;

          const task = { title, description, assignedTo, status };

          console.log("Submitting task:", task);

          try {
            const response = await fetch(
              "https://5ri4i2h0d8.execute-api.eu-west-1.amazonaws.com/Prod/create",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(task),
              }
            );

            const data = await response.json();

            if (response.ok) {
              alert("Task created successfully!");
              form.reset();
              loadTasks();
            } else {
              alert(
                "Error creating task: " + (data.message || response.statusText)
              );
            }
          } catch (err) {
            alert("Request failed: " + err.message);
          }
        });

        async function loadTasks() {
          try {
            const response = await fetch(
              "https://5ri4i2h0d8.execute-api.eu-west-1.amazonaws.com/Prod/tasks"
            );
            const tasks = await response.json();

            console.log("Loaded tasks:", tasks);

            const container = document.getElementById("taskList");
            container.innerHTML = "<h2>Tasks</h2>";

            tasks.forEach((task) => {
              const div = document.createElement("div");
              div.className = "task-card";
              div.innerHTML = `
              <h3>${task.title}</h3>
              <p>${task.description}</p>
              <p class="task-meta"><strong>Assigned to:</strong> ${task.assignedTo}</p>
              <p class="task-meta"><strong>Status:</strong> ${task.status}</p>
              <button onclick="editTask('${task.id}')">Edit</button>
            `;
              container.appendChild(div);
            });
          } catch (err) {
            console.error("Failed to load tasks:", err);
            alert("Failed to load tasks: " + err.message);
          }
        }

        window.editTask = function (taskId) {
          const newTitle = prompt("Enter new title:");
          const newDescription = prompt("Enter new description:");
          const newAssignedTo = prompt("Enter new assigned person:");
          const newStatus = prompt(
            "Enter new status (pending/in progress/completed):"
          );

          if (newTitle && newDescription && newAssignedTo && newStatus) {
            const updatedData = {
              title: newTitle,
              description: newDescription,
              assignedTo: newAssignedTo,
              status: newStatus,
            };
            updateTask(taskId, updatedData);
          }
        };

        async function updateTask(taskId, updatedData) {
          try {
            const response = await fetch(
              `https://5ri4i2h0d8.execute-api.eu-west-1.amazonaws.com/Prod/task/${taskId}`,
              {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(updatedData),
              }
            );

            if (response.ok) {
              alert("Task updated!");
              loadTasks();
            } else {
              const error = await response.json();
              alert("Update failed: " + (error.message || response.statusText));
            }
          } catch (err) {
            alert("Error: " + err.message);
          }
        }

        loadTasks(); // initial load
      });
    </script>
  </body>
</html>
